<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="io.github.timemachinelab.mapper.ConfigMapper">
    
    <insert id="insertOrUpdate" parameterType="io.github.timemachinelab.pojo.entity.ConfigItemDO">
        INSERT INTO config_item (
            id,
            app_name,
            environment,
            config_key,
            <if test="configValue != null">config_value,</if>
            <if test="description != null">description,</if>
            <if test="dataType != null">data_type,</if>
            <if test="isActive != null">is_active,</if>
            created_by,
            updated_by,
            created_time,
            updated_time,
            version
        ) VALUES (
            #{id},
            #{appName},
            #{environment},
            #{configKey},
            <if test="configValue != null">#{configValue},</if>
            <if test="description != null">#{description},</if>
            <if test="dataType != null">#{dataType},</if>
            <if test="isActive != null">#{isActive},</if>
            #{createdBy},
            #{updatedBy},
            NOW(),
            NOW(),
            1
        )
        ON DUPLICATE KEY UPDATE
            <trim suffixOverrides=",">
                <if test="configValue != null">config_value = VALUES(config_value),</if>
                <if test="description != null">description = VALUES(description),</if>
                <if test="dataType != null">data_type = VALUES(data_type),</if>
                <if test="isActive != null">is_active = VALUES(is_active),</if>
                updated_by = VALUES(updated_by),
                updated_time = NOW(),
                version = LAST_INSERT_ID(version + 1)
            </trim>
    </insert>
    
</mapper>